<!DOCTYPE html><html><head><title>Persistence</title><style type="text/css">::selection {background-color: #000000; color: #000000;}::-moz-selection {background-color: #000000; color: #000000;}::-o-selection {background-color: #000000; color: #000000;}::-ms-selection {background-color: #000000; color: #000000;}::-webkit-selection {background-color: #000000; color: #000000;}</style></head>
<body style="background-color:#000000"><center><canvas onmousedown="grab()" id="canvas"></canvas></center></body></html>

<script type="text/javascript">
var a={v:0, h:0, dir:1, grabdir:1, grabcooloff:0, grip:4, connect:0, griptime:0, ai:0, prizegrabchance:0.2, missgrabchance:0.08, timesincegrab:0};
var b={v:480, h:450, dir:-1, grabdir:-1, grabcooloff:0, grip:4, connect:0, griptime:0, ai:1, prizegrabchance:0.25, missgrabchance:0.12, timesincegrab:0};

var block=[];
block[0]={fill:"purple", stroke:"black", width:80, height:76, v:68, h:210, type:1};
block[1]={fill:"purple", stroke:"black", width:80, height:76, v:212, h:210, type:1};
block[2]={fill:"purple", stroke:"black", width:80, height:76, v:356, h:210, type:1};

var topconnect, bottomconnect;

var canvas = document.getElementById("canvas"), ctx = canvas.getContext("2d");
canvas.width = 500;
canvas.height = 500;

function draw(){
ctx.fillStyle = "white"; ctx.fillRect(0,0,500,500);
ctx.fillStyle = "#FF0000"; ctx.strokeStyle = "black"; ctx.fillRect(a.h, a.v, 100, 20); ctx.strokeRect(a.h, a.v, 100, 20);
ctx.fillStyle = "#0000FF"; ctx.strokeStyle = "black"; ctx.fillRect(b.h, b.v, 100, 20); ctx.strokeRect(b.h, b.v, 100, 20);
ctx.fillStyle = "grey"; ctx.strokeStyle = "black"; ctx.fillRect(200, 0, 100, 68); ctx.strokeRect(200, 0, 100, 68);
ctx.fillStyle = "purple"; ctx.strokeStyle = "black"; ctx.fillRect(210, 68, 80, 76); ctx.strokeRect(210, 68, 80, 76);
ctx.fillStyle = "grey"; ctx.strokeStyle = "black"; ctx.fillRect(200, 144, 100, 68); ctx.strokeRect(200, 144, 100, 68);
ctx.fillStyle = "purple"; ctx.strokeStyle = "black"; ctx.fillRect(210, 210, 80, 76); ctx.strokeRect(210, 210, 80, 76);
ctx.fillStyle = "grey"; ctx.strokeStyle = "black"; ctx.fillRect(200, 288, 100, 68); ctx.strokeRect(200, 288, 100, 68);
ctx.fillStyle = "purple"; ctx.strokeStyle = "black"; ctx.fillRect(210, 356, 80, 76); ctx.strokeRect(210, 356, 80, 76);
ctx.fillStyle = "grey"; ctx.strokeStyle = "black"; ctx.fillRect(200, 432, 100, 68); ctx.strokeRect(200, 432, 100, 68);

for(var i=0; i<block.length; i++){
	ctx.fillStyle = block[i].fill;
	ctx.strokeStyle = block[i].stroke;
	ctx.fillRect(block[i].h, block[i].v, block[i].width, block[i].height);
	ctx.strokeRect(block[i].h, block[i].v, block[i].width, block[i].height);
	}

}

function frame(){

for(var i=1; i<block.length; i++){if(a.v<block[i].v){topconnect=i-1; i=block.length;} else{topconnect=i;}}
for(var i=1; i<block.length; i++){if(a.v<block[i].v-20){bottomconnect=i-1; i=block.length;} else{bottomconnect=i;}}
if(block[topconnect].h<block[bottomconnect].h){a.connect=topconnect;} else{a.connect=bottomconnect;}

if(a.h>0){graba();}
else if(a.ai==1){aai();}
else{aframe()}

for(var i=1; i<block.length; i++){if(b.v<block[i].v){topconnect=i-1; i=block.length;} else{topconnect=i;}}
for(var i=1; i<block.length; i++){if(b.v<block[i].v-20){bottomconnect=i-1; i=block.length;} else{bottomconnect=i;}}
if(block[topconnect].h>block[bottomconnect].h){b.connect=topconnect;} else{b.connect=bottomconnect;}

if(b.h<500-100){grabb();}
else if(b.ai==1){bai();}
else{bframe()}

draw();
setTimeout(frame,(16));
}

function aframe(){
	a.v+=a.dir*5;
	if(a.v>(500-20)-1){a.v=500-20; a.dir=-1;}
	if(a.v<1){a.v=0; a.dir=1;}
	a.timesincegrab++;
	if(a.timesincegrab>a.grabcooloff){a.timesincegrab=a.grabcooloff+1;}
	}

function bframe(){
	b.v+=b.dir*5;
	if(b.v>(500-20)-1){b.v=500-20; b.dir=-1;}
	if(b.v<1){b.v=0; b.dir=1;}
	b.timesincegrab++;
	if(b.timesincegrab>b.grabcooloff){b.timesincegrab=b.grabcooloff+1;}
	}

function graba(){
a.h+=a.grabdir*7;

if(a.grabdir==-1 && block[a.connect].type==1 && a.griptime<a.grip){block[a.connect].h+=a.grabdir*7; a.griptime++;}

if(a.h>block[a.connect].h-100){a.h=block[a.connect].h-100; a.grabdir=-1;}
if(a.h<1){a.h=0; a.grabdir=1; a.griptime=0;}
}

function grabb(){
b.h+=b.grabdir*7;

if(b.grabdir==1 && block[b.connect].type==1 && b.griptime<b.grip){block[b.connect].h+=b.grabdir*7; b.griptime++;}

if(b.h<block[b.connect].h+block[b.connect].width){b.h=block[b.connect].h+block[b.connect].width; b.grabdir=1;}
if(b.h>500-100-1){b.h=500-100; b.grabdir=-1; b.griptime=0;}
}

function aai(){
	if(a.timesincegrab>a.grabcooloff-1 && block[a.connect].type==1 && a.prizegrabchance>Math.random()){graba(); a.timesincegrab=0;}
	else if(a.timesincegrab>a.grabcooloff-1 && block[a.connect].type==0 && a.missgrabchance>Math.random()){graba(); a.timesincegrab=0;}
	else{aframe();}
}

function bai(){
	if(b.timesincegrab>b.grabcooloff-1 && block[b.connect].type==1 && b.prizegrabchance>Math.random()){grabb(); b.timesincegrab=0;}
	else if(b.timesincegrab>b.grabcooloff-1 && block[b.connect].type==0 && b.missgrabchance>Math.random()){grabb(); b.timesincegrab=0;}
	else{bframe();}
}

function grab(){
	if(a.timesincegrab>a.grabcooloff){graba(); a.timesincegrab=0;}
	else{framea;}
}

frame();

</script>
